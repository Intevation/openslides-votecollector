{% extends 'base.html' %}

{% load i18n %}
{% load staticfiles %}
{% load tags %}

{% block header %}
    {{ block.super }}
    <link href="{% static 'css/dataTables/dataTables.bootstrap.css' %}" type="text/css" rel="stylesheet">
{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script src="{% static 'js/jquery/jquery.dataTables.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery/dataTables.bootstrap.js' %}" type="text/javascript"></script>
{% endblock %}

{% block content %}
    <h1>
        {{ motion }}
        <br>
        <small>
        {% trans "Motion" %} {{ motion.identifier }}, {{ poll }}
        </small>
        <small class="pull-right">
            <a href="{% url 'motion_detail' motion.id %}" class="btn btn-mini"><i class="icon-chevron-left"></i> {% trans "Back to motion" %}</a>
            <!-- activate projector -->
            {% if perms.core.can_manage_projector %}
                <a href="{{ motion|absolute_url:'projector' }}" class="activate_link btn {% if motion.is_active_slide %}btn-primary{% endif %} btn-mini"
                    rel="tooltip" data-original-title="{% trans 'Show motion' %}">
                    <i class="icon-facetime-video {% if motion.is_active_slide %}icon-white{% endif %}"></i>
                </a>
                <a class="btn btn-mini activate_link {% if poll.is_active_slide %}btn-primary{% endif %}" href="{{ poll|absolute_url:'projector' }}"
                    rel="tooltip" data-original-title="{% trans 'Show vote result' %}">
                    <i class="icon-facetime-video {% if poll.is_active_slide %}icon-white{% endif %}"></i> {% trans "Vote result" %}</a>
            {% endif %}
            {% if perms.motion.can_manage_motion %}
                <a class="btn btn-mini" href="{{ poll|absolute_url:'delete' }}"
                    rel="tooltip" data-original-title="{% trans 'Delete Vote' %}"><i class="icon-remove"></i></a>
            {% endif %}
        </small>
    </h1>

    <h2>{% trans 'Voting result' %}</h2>
    {% with poll.get_options.0 as option %}
        <table class="table table-bordered">
            <caption style="display:none">{% trans 'Voting result' %}</caption>
            <tr>
                <td>{% trans 'Yes' %}</td>
                <td>{{ option.Yes }}</td>
            </tr>
            <tr>
                <td>{% trans 'No' %}</td>
                <td>{{ option.No }}</td>
            </tr>
            <tr>
                <td>{% trans 'Abstention' %}</td>
                <td>{{ option.Abstain }}</td>
            </tr>
            {% if poll.votesvalid != None or poll.votesinvalid != None %}
                {% if poll.votesvalid != None %}
                    <tr>
                        <td>{% trans 'Valid votes' %}</td>
                        <td>{{ poll.print_votesvalid }}</td>
                    </tr>
                {% endif %}
                {% if poll.votesinvalid != None %}
                    <tr>
                        <td>{% trans 'Invalid Votes' %}</td>
                        <td>{{ poll.print_votesinvalid }}</td>
                    </tr>
                {% endif %}
            {% endif %}
            {% if poll.votescast != None %}
                <tr>
                    <td>{% trans 'Votes cast' %}</td>
                    <td>{{ poll.print_votescast }}</td>
                </tr>
            {% endif %}
        </table>
    {% endwith %}

    <h2>{% trans 'All votes' %}</h2>
    <table id="dataTable" class="table table-striped table-bordered">
        <caption style="display:none">{% trans 'All votes' %}</caption>
        <thead>
            <tr>
                <th>{% trans 'Name' %}</th>
                <th class="optional">{% trans 'Structure level' %}</th>
                <th class="optional">{% trans 'Keypad id or serial number' %}</th>
                <th class="optional">{% trans 'Vote' %}</th>
            </tr>
        </thead>
        <tbody>
            {% for keypad_data in keypad_data_list %}
                <tr>
                    <td>
                        {% if keypad_data.keypad.user %}
                            <a href="{% url 'user_view' keypad_data.keypad.user.id %}">
                                {{ keypad_data.keypad.user.title }}
                                {% if 'participant_sort_users_by_first_name'|get_config %}
                                        {{ keypad_data.keypad.user.first_name }} {{ keypad_data.keypad.user.last_name }}
                                {% else %}
                                        {{ keypad_data.keypad.user.last_name }}{% if keypad_data.keypad.user.last_name and keypad_data.keypad.user.first_name %},{% endif %} {{ keypad_data.keypad.user.first_name }}
                                {% endif %}
                            </a>
                        {% else %}
                            {% trans 'Anonymous' %}
                        {% endif %}
                     </td>
                    <td class="optional">{{ keypad_data.keypad.user.structure_level }}</td>
                    <td class="optional">
                        {% if keypad_data.serial_number %}
                            {{ keypad_data.serial_number }}
                        {% else %}
                            {{ keypad_data.keypad.keypad_id }}
                        {% endif %}
                    </td>
                    <td class="optional">{{ keypad_data.get_value }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
